{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "mint-cToken",
  "type": "registry:block",
  "title": "Mint cToken",
  "description": "A simple mint cToken form component.",
  "dependencies": [
    "@solana/web3.js",
    "@solana/spl-token",
    "@solana/wallet-adapter-react",
    "@lightprotocol/stateless.js",
    "@lightprotocol/compressed-token"
  ],
  "registryDependencies": [
    "input",
    "button",
    "form",
    "card",
    "sonner",
    "select",
    "dialog",
    "dropdown-menu"
  ],
  "files": [
    {
      "path": "components/ui/murphy/mint-cToken.tsx",
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { toast } from \"sonner\";\nimport { Loader2, Wallet } from \"lucide-react\";\nimport { \n  Keypair, \n  PublicKey, \n  Transaction,\n  SystemProgram,\n  LAMPORTS_PER_SOL,\n  Signer\n} from \"@solana/web3.js\";\nimport { useWallet, useConnection } from \"@solana/wallet-adapter-react\";\nimport { \n  createMint, \n  createTokenPool,\n  compress,\n} from \"@lightprotocol/compressed-token\";\nimport { getAssociatedTokenAddress, getOrCreateAssociatedTokenAccount, mintTo } from \"@solana/spl-token\";\nimport { createRpc } from \"@lightprotocol/stateless.js\";\nimport bs58 from \"bs58\";\n\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { ConnectWalletButton } from \"./connect-wallet-button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\n\n// Type for mint form values\ntype MintFormValues = {\n  tokenName: string;\n  tokenSymbol: string;\n  decimals: number;\n  supply: number;\n};\n\n// Create custom resolver for form\nconst customResolver = (data: any) => {\n  const errors: any = {};\n\n  if (!data.tokenName) {\n    errors.tokenName = {\n      type: \"required\",\n      message: \"Token name is required\",\n    };\n  }\n\n  if (!data.tokenSymbol) {\n    errors.tokenSymbol = {\n      type: \"required\",\n      message: \"Token symbol is required\",\n    };\n  }\n\n  if (data.decimals === undefined || data.decimals === null || data.decimals === \"\") {\n    errors.decimals = {\n      type: \"required\",\n      message: \"Decimals are required\",\n    };\n  } else if (Number(data.decimals) < 0 || Number(data.decimals) > 9) {\n    errors.decimals = {\n      type: \"range\",\n      message: \"Decimals must be between 0 and 9\",\n    };\n  }\n\n  if (data.supply === undefined || data.supply === null || data.supply === \"\") {\n    errors.supply = {\n      type: \"required\",\n      message: \"Supply is required\",\n    };\n  } else if (Number(data.supply) <= 0) {\n    errors.supply = {\n      type: \"min\",\n      message: \"Supply must be greater than 0\",\n    };\n  }\n\n  return {\n    values: Object.keys(errors).length === 0 ? data : {},\n    errors,\n  };\n};\n\nexport function MintTokenForm({ className }: { className?: string }) {\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [currentStage, setCurrentStage] = useState('input'); // input, confirming, success, error\n  const [error, setError] = useState('');\n  const [transactionSignature, setTransactionSignature] = useState('');\n  const [mintAddress, setMintAddress] = useState('');\n  const [ataAddress, setAtaAddress] = useState('');\n  \n  const { publicKey, connected, signTransaction, sendTransaction } = useWallet();\n  const { connection } = useConnection();\n\n  // Form setup with react-hook-form\n  const form = useForm<MintFormValues>({\n    defaultValues: {\n      tokenName: \"\",\n      tokenSymbol: \"\",\n      decimals: 9,\n      supply: 1000000000, // Default 1 billion\n    },\n    mode: \"onSubmit\",\n    resolver: customResolver,\n  });\n\n  // Adapter to convert signTransaction to Signer\n  const createSignerAdapter = () => {\n    const adapter = {\n      publicKey: publicKey!,\n      secretKey: Uint8Array.from([]), // Not actually used\n      async signTransaction(tx: Transaction) {\n        tx.feePayer = publicKey!;\n        const { blockhash, lastValidBlockHeight } = await connection.getLatestBlockhash();\n        tx.recentBlockhash = blockhash;\n        return await signTransaction!(tx);\n      }\n    } as Signer;\n    return adapter;\n  };\n\n  // Then use this adapter with APIs\n  const signerAdapter = createSignerAdapter();\n\n  // Handle form submission\n  const onSubmit = async (values: MintFormValues) => {\n    if (!connected || !publicKey) {\n      toast.error(\"Wallet not connected\");\n      return;\n    }\n\n    if (!signTransaction || !sendTransaction) {\n      toast.error(\"Wallet does not support transaction signing\");\n      return;\n    }\n\n    try {\n      setIsSubmitting(true);\n      setError('');\n      setCurrentStage('confirming');\n\n      // Create RPC connection\n      const lightConnection = createRpc(\n        connection.rpcEndpoint,\n        connection.rpcEndpoint,\n        connection.rpcEndpoint\n      );\n      \n      toast.message(\"Creating token...\", {\n        description: \"Initializing transaction\"\n      });\n      \n      // Create a new mint keypair\n      const mintKeypair = Keypair.generate();\n      \n      // Create mint (token) using compressed-token API\n      const { mint: mintPubkey, transactionSignature: createMintTxId } = await createMint(\n        lightConnection,\n        signerAdapter,\n        publicKey,\n        values.decimals\n      );\n      \n      // Create associated token account to store tokens\n      const ata = await getOrCreateAssociatedTokenAccount(\n        lightConnection,\n        signerAdapter,\n        mintPubkey,\n        publicKey\n      );\n      \n      // Mint tokens into user's associated token account\n      const mintToTxId = await mintTo(\n        lightConnection,\n        signerAdapter,\n        mintPubkey,\n        ata.address,\n        publicKey,\n        values.supply * Math.pow(10, values.decimals)\n      );\n      \n      // Compress the newly created tokens\n      const compressedTokenTxId = await compress(\n        lightConnection,\n        signerAdapter,\n        mintPubkey,\n        values.supply * Math.pow(10, values.decimals) / 2,\n        signerAdapter,\n        ata.address,\n        publicKey\n      );\n      \n      // Save information\n      setTransactionSignature(compressedTokenTxId);\n      setMintAddress(mintPubkey.toString());\n      setAtaAddress(ata.address.toString());\n      setCurrentStage('success');\n      \n      toast.success(\"Compressed token created successfully!\", {\n        description: `Transaction: ${compressedTokenTxId}`\n      });\n\n      form.reset();\n    } catch (error: any) {\n      console.error('Error creating token:', error);\n      \n      // Check if user rejected the transaction\n      if (error.message && error.message.includes(\"User rejected\")) {\n        setError(\"User rejected the transaction\");\n        toast.error(\"Transaction was canceled\", {\n          description: \"You canceled the token creation transaction\"\n        });\n      } else {\n        setError(`Token creation failed: ${error.message}`);\n        toast.error(\"Transaction failed\", {\n          description: error.message || \"Unable to create token\"\n        });\n      }\n      \n      setCurrentStage('error');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  // Render success view\n  const renderSuccess = () => (\n    <div className=\"space-y-4 p-4 text-center\">\n      <div className=\"mx-auto flex h-20 w-20 items-center justify-center rounded-full bg-green-100\">\n        <svg className=\"h-10 w-10 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n        </svg>\n      </div>\n      <h3 className=\"text-xl font-bold\">Token Created Successfully!</h3>\n      <p className=\"text-muted-foreground\">Your compressed token has been created.</p>\n      {mintAddress && (\n        <div className=\"p-2 bg-gray-50 rounded text-sm break-all\">\n          <span className=\"font-medium\">Token Address:</span> {mintAddress}\n        </div>\n      )}\n      {ataAddress && (\n        <div className=\"p-2 bg-gray-50 rounded text-sm break-all mt-2\">\n          <span className=\"font-medium\">Associated Token Account:</span> {ataAddress}\n        </div>\n      )}\n      {transactionSignature && (\n        <a \n          href={`https://explorer.solana.com/tx/${transactionSignature}?cluster=devnet`} \n          target=\"_blank\" \n          rel=\"noopener noreferrer\"\n          className=\"text-primary hover:underline\"\n        >\n          View Transaction\n        </a>\n      )}\n      <Button \n        onClick={() => {\n          setCurrentStage('input');\n          form.reset();\n        }}\n        className=\"w-full\"\n      >\n        Create Another Token\n      </Button>\n    </div>\n  );\n\n  // Render error view\n  const renderError = () => (\n    <div className=\"space-y-4 p-4 text-center\">\n      <div className=\"mx-auto flex h-20 w-20 items-center justify-center rounded-full bg-red-100\">\n        <svg className=\"h-10 w-10 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n        </svg>\n      </div>\n      <h3 className=\"text-xl font-bold\">Token Creation Failed</h3>\n      <p className=\"text-muted-foreground\">{error || 'An error occurred while creating the token.'}</p>\n      <Button \n        onClick={() => {\n          setCurrentStage('input');\n        }}\n        className=\"w-full\"\n      >\n        Try Again\n      </Button>\n    </div>\n  );\n\n  // Render confirmation view\n  const renderConfirming = () => (\n    <div className=\"space-y-4 p-4 text-center\">\n      <div className=\"mx-auto flex h-20 w-20 items-center justify-center\">\n        <Loader2 className=\"h-10 w-10 animate-spin\" />\n      </div>\n      <h3 className=\"text-xl font-bold\">Creating Token</h3>\n      <p className=\"text-muted-foreground\">Please confirm the transaction in your wallet...</p>\n    </div>\n  );\n\n  // Render input form\n  const renderInputForm = () => (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        <FormField\n          control={form.control}\n          name=\"tokenName\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Token Name</FormLabel>\n              <FormControl>\n                <Input placeholder=\"My Token\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"tokenSymbol\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Token Symbol</FormLabel>\n              <FormControl>\n                <Input placeholder=\"MTK\" {...field} />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"decimals\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Decimals</FormLabel>\n              <FormControl>\n                <Input \n                  type=\"number\" \n                  min={0} \n                  max={9} \n                  {...field} \n                  onChange={(e) => field.onChange(Number(e.target.value))}\n                />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"supply\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Initial Supply</FormLabel>\n              <FormControl>\n                <Input \n                  type=\"number\" \n                  min={1} \n                  {...field} \n                  onChange={(e) => field.onChange(Number(e.target.value))}\n                />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <div className=\"pt-2\">\n          {!connected ? (\n            <ConnectWalletButton className=\"w-full\" />\n          ) : (\n            <Button\n              type=\"submit\"\n              className=\"w-full\"\n              disabled={isSubmitting}\n            >\n              {isSubmitting ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                  Creating Token...\n                </>\n              ) : (\n                \"Create Token\"\n              )}\n            </Button>\n          )}\n        </div>\n      </form>\n    </Form>\n  );\n\n  // Render based on current stage\n  const renderStageContent = () => {\n    switch (currentStage) {\n      case 'success':\n        return renderSuccess();\n      case 'error':\n        return renderError();\n      case 'confirming':\n        return renderConfirming();\n      default:\n        return renderInputForm();\n    }\n  };\n\n  return (\n    <Card className={`w-full max-w-3xl mx-auto ${className || \"\"}`}>\n      <CardHeader>\n        <CardTitle className=\"flex items-center\">\n          <Wallet className=\"h-5 w-5 mr-2\" />\n          Create Compressed Token\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        {renderStageContent()}\n      </CardContent>\n    </Card>\n  );\n}\n\nexport default MintTokenForm;",
      "type": "registry:component",
      "target": "components/ui/murphy/mint-cToken.tsx"
    }
  ]
}